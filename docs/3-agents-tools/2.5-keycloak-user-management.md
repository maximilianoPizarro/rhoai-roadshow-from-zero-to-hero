# üîê Keycloak User Management

## Overview

Neuralbank uses **Keycloak** for authentication and authorization. As part of the setup, you may need to create users for testing and development purposes.

## Accessing Keycloak

1. **Navigate to Keycloak Console**:
   <a href="https://sso.apps.<CLUSTER_DOMAIN>" target="_blank">https://sso.apps.<CLUSTER_DOMAIN></a>

2. **Login**: Use your admin credentials to access the Keycloak administration console

![Keycloak Neuralbank](../images/rhbk-neuralbank.png)

## Creating a New User

### Step 1: Navigate to Users

1. **Select Realm**: Choose the `neuralbank` realm from the dropdown
2. **Go to Users**: Click on "Users" in the left menu
3. **Add User**: Click the "Add user" button

![Create User](../images/rhbk-create-user.png)

### Step 2: Configure User Details

1. **Username**: Enter a unique username (e.g., `kevin`, `commercial-agent-1`)
2. **Email**: Enter the user's email address
3. **First Name**: Enter the user's first name
4. **Last Name**: Enter the user's last name
5. **Email Verified**: Toggle if the email is verified
6. **Enabled**: Ensure this is enabled (default)

![Create User Set Password](../images/rhbk-create-user-set-password.png)

### Step 3: Set Password

1. **Go to Credentials Tab**: Click on the "Credentials" tab
2. **Set Password**: Click "Set password"
3. **Enter Password**: Provide a secure password
4. **Temporary**: Uncheck "Temporary" if you want a permanent password
5. **Save**: Click "Save"

### Step 4: Assign Roles (Optional)

1. **Go to Role Mappings**: Click on "Role Mappings" tab
2. **Assign Groups**: Add the user to appropriate groups:
   - `US-Clients` - For US-based clients
   - `LATAM-Clients` - For Latin America clients
   - `EU-Clients` - For European clients
3. **Assign Realm Roles**: Add appropriate realm roles:
   - `personal-client` - For individual clients
   - `corporate-client` - For corporate clients
4. **Assign Client Roles**: If needed, assign client-specific roles

## Login Flow

When users access Neuralbank services, they go through the following authentication flow:

![Login Flow](../images/login.png)

### Step 1: Access Service

User attempts to access a protected Neuralbank service:
- **Neuralbank Web Site**: <a href="https://neuralbank.apps.<CLUSTER_DOMAIN>" target="_blank">https://neuralbank.apps.<CLUSTER_DOMAIN></a>
- **Playground**: LlamaStack Playground interface
- **Frontend**: Customer and commercial agent interfaces

### Step 2: Redirect to Keycloak

The service redirects the user to Keycloak for authentication

![Keycloak Login](../images/rhbk-neuralbank-login.png)

### Step 3: User Authentication

User enters credentials:
- **Username**: The username created in Keycloak
- **Password**: The password set for the user

### Step 4: Token Issuance

Upon successful authentication, Keycloak issues:
- **Access Token**: Used for API calls
- **Refresh Token**: Used to obtain new access tokens
- **ID Token**: Contains user identity information

### Step 5: Service Access

The user is redirected back to the service with the tokens, allowing access to protected resources

## Testing Authentication

You can test the authentication flow by:

1. **Accessing Playground**: Navigate to the LlamaStack Playground
2. **Login Prompt**: You'll be redirected to Keycloak
3. **Enter Credentials**: Use the user credentials you created
4. **Access Granted**: Once authenticated, you can use the Playground

## User Roles and Groups

The Neuralbank realm includes the following groups and realm roles:

### Groups

- **US-Clients**: Clients from the United States
- **LATAM-Clients**: Clients from Latin America
- **EU-Clients**: Clients from Europe

### Realm Roles

- **personal-client**: For individual/personal clients
- **corporate-client**: For corporate/business clients

### Additional Roles

- **commercial-agent**: Can query and update credit risk
- **developer**: Can develop and test MCP agents
- **admin**: Full administrative access
- **viewer**: Read-only access to credit risk data

## Next Steps

Now that you understand user management in Keycloak, let's explore **Connectivity Link** to understand how services communicate securely in Neuralbank.

Click **Connectivity Link** to continue, or proceed to **Build MCP Agent** if you're ready to start coding.

